src.rag_toolkit.core.chunking
=============================

.. py:module:: src.rag_toolkit.core.chunking

.. autoapi-nested-parse::

   Chunking utilities.



Submodules
----------

.. toctree::
   :maxdepth: 1

   /autoapi/src/rag_toolkit/core/chunking/chunking/index
   /autoapi/src/rag_toolkit/core/chunking/dynamic_chunker/index
   /autoapi/src/rag_toolkit/core/chunking/models/index
   /autoapi/src/rag_toolkit/core/chunking/types/index


Classes
-------

.. autoapisummary::

   src.rag_toolkit.core.chunking.DynamicChunker
   src.rag_toolkit.core.chunking.TokenChunker
   src.rag_toolkit.core.chunking.Chunk
   src.rag_toolkit.core.chunking.TokenChunk
   src.rag_toolkit.core.chunking.ChunkLike
   src.rag_toolkit.core.chunking.TokenChunkLike


Package Contents
----------------

.. py:class:: DynamicChunker(*, include_tables = True, max_heading_level = 6, allow_preamble = False)

   Create chunks using level-1 headings as anchors.


   .. py:attribute:: include_tables
      :value: True



   .. py:attribute:: max_heading_level
      :value: 6



   .. py:attribute:: allow_preamble
      :value: False



   .. py:method:: build_chunks(pages)

      Build chunks from parsed pages.

      A chunk starts at a heading with level 1 and includes:
      - all subsequent headings with level > 1 (up to max_heading_level)
      - paragraphs/list/table blocks until the next level-1 heading (excluded).

      :param pages: Parsed pages with blocks (as produced by the ingestion parser).

      :returns: List of chunks preserving document order.



.. py:class:: TokenChunker(*, max_tokens = DEFAULT_MAX_TOKENS, min_tokens = DEFAULT_MIN_TOKENS, overlap_tokens = DEFAULT_OVERLAP, tokenizer = default_tokenizer)

   Chunk text by tokens with overlap and metadata extraction.


   .. py:attribute:: max_tokens


   .. py:attribute:: min_tokens


   .. py:attribute:: overlap_tokens


   .. py:attribute:: tokenizer


   .. py:method:: chunk(structured_chunks)

      Chunk higher-level sections into token-based chunks.

      :param structured_chunks: Chunks produced by ``DynamicChunker``.

      :returns: List of token chunks with metadata and section path.



.. py:class:: Chunk

   Standard implementation of ChunkLike protocol.


   .. py:attribute:: id
      :type:  str


   .. py:attribute:: title
      :type:  str


   .. py:attribute:: heading_level
      :type:  int


   .. py:attribute:: text
      :type:  str


   .. py:attribute:: blocks
      :type:  List[Dict[str, Any]]
      :value: []



   .. py:attribute:: page_numbers
      :type:  List[int]
      :value: []



   .. py:method:: to_dict(*, include_blocks = True)

      Convert chunk to dictionary representation.



.. py:class:: TokenChunk

   Standard implementation of TokenChunkLike protocol.


   .. py:attribute:: id
      :type:  str


   .. py:attribute:: text
      :type:  str


   .. py:attribute:: section_path
      :type:  str


   .. py:attribute:: metadata
      :type:  Dict[str, str]


   .. py:attribute:: page_numbers
      :type:  List[int]
      :value: []



   .. py:attribute:: source_chunk_id
      :type:  str
      :value: ''



   .. py:method:: to_dict()

      Convert token chunk to dictionary representation.



.. py:class:: ChunkLike

   Bases: :py:obj:`Protocol`


   Protocol defining the interface for document chunks.

   This Protocol allows domain layers to implement their own chunk types
   with additional fields while maintaining compatibility with core chunking logic.

   Example domain implementation:
       ```python
       @dataclass
       class TenderChunk:
           id: str
           title: str
           heading_level: int
           text: str
           blocks: List[Dict[str, Any]]
           page_numbers: List[int]
           # Domain-specific fields
           tender_id: str
           lot_id: Optional[str]
           section_type: str

           def to_dict(self, *, include_blocks: bool = True) -> Dict[str, Any]:
               data = {
                   "id": self.id,
                   "title": self.title,
                   "heading_level": self.heading_level,
                   "text": self.text,
                   "page_numbers": self.page_numbers,
                   "tender_id": self.tender_id,
                   "lot_id": self.lot_id,
                   "section_type": self.section_type,
               }
               if include_blocks:
                   data["blocks"] = self.blocks
               return data
       ```

   .. attribute:: id

      Unique identifier for the chunk

   .. attribute:: title

      Section title or heading

   .. attribute:: heading_level

      Hierarchical level of the heading (e.g., h1=1, h2=2)

   .. attribute:: text

      The actual text content of the chunk

   .. attribute:: blocks

      List of structured text blocks within this chunk

   .. attribute:: page_numbers

      List of page numbers where this chunk appears


   .. py:attribute:: id
      :type:  str


   .. py:attribute:: title
      :type:  str


   .. py:attribute:: heading_level
      :type:  int


   .. py:attribute:: text
      :type:  str


   .. py:attribute:: blocks
      :type:  List[Dict[str, Any]]


   .. py:attribute:: page_numbers
      :type:  List[int]


   .. py:method:: to_dict(*, include_blocks = True)

      Convert chunk to dictionary representation.

      :param include_blocks: Whether to include the blocks field in the output

      :returns: id, title, heading_level, text,
                page_numbers. Implementations may include additional fields.
      :rtype: Dictionary containing at minimum



.. py:class:: TokenChunkLike

   Bases: :py:obj:`Protocol`


   Protocol defining the interface for token-optimized chunks.

   Token chunks are optimized for embedding and retrieval operations,
   typically derived from larger document chunks with enhanced metadata.

   Example domain implementation:
       ```python
       @dataclass
       class TenderTokenChunk:
           id: str
           text: str
           section_path: str
           metadata: Dict[str, str]
           page_numbers: List[int]
           source_chunk_id: str
           # Domain-specific fields
           tender_id: str
           lot_id: Optional[str]
           section_type: str

           def to_dict(self) -> Dict[str, Any]:
               return {
                   "id": self.id,
                   "text": self.text,
                   "section_path": self.section_path,
                   "metadata": self.metadata,
                   "page_numbers": self.page_numbers,
                   "source_chunk_id": self.source_chunk_id,
                   "tender_id": self.tender_id,
                   "lot_id": self.lot_id,
                   "section_type": self.section_type,
               }
       ```

   .. attribute:: id

      Unique identifier for the token chunk

   .. attribute:: text

      The token-optimized text content

   .. attribute:: section_path

      Hierarchical path to the section (e.g., "Section 1 > Subsection A")

   .. attribute:: page_numbers

      List of page numbers where this chunk appears

   .. attribute:: metadata

      Additional metadata as key-value pairs

   .. attribute:: source_chunk_id

      Reference to the original Chunk this was derived from


   .. py:attribute:: id
      :type:  str


   .. py:attribute:: text
      :type:  str


   .. py:attribute:: section_path
      :type:  str


   .. py:attribute:: metadata
      :type:  Dict[str, str]


   .. py:attribute:: page_numbers
      :type:  List[int]


   .. py:attribute:: source_chunk_id
      :type:  str


   .. py:method:: to_dict()

      Convert token chunk to dictionary representation.

      :returns: id, text, section_path, metadata,
                page_numbers, source_chunk_id. Implementations may include additional fields.
      :rtype: Dictionary containing at minimum



