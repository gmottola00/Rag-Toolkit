src.rag_toolkit.core.ingestion
==============================

.. py:module:: src.rag_toolkit.core.ingestion

.. autoapi-nested-parse::

   Document ingestion - Core abstractions and orchestration.

   This module provides the abstract interfaces and generic orchestration logic
   for document ingestion. Concrete implementations live in src.infra.parsers.



Submodules
----------

.. toctree::
   :maxdepth: 1

   /autoapi/src/rag_toolkit/core/ingestion/base/index
   /autoapi/src/rag_toolkit/core/ingestion/service/index


Attributes
----------

.. autoapisummary::

   src.rag_toolkit.core.ingestion.PageDict


Classes
-------

.. autoapisummary::

   src.rag_toolkit.core.ingestion.DocumentParser
   src.rag_toolkit.core.ingestion.HeadingDetector
   src.rag_toolkit.core.ingestion.LanguageDetector
   src.rag_toolkit.core.ingestion.OCREngine
   src.rag_toolkit.core.ingestion.TableDetector
   src.rag_toolkit.core.ingestion.IngestionService


Package Contents
----------------

.. py:class:: DocumentParser

   Bases: :py:obj:`Protocol`


   Abstract interface for parsing documents into structured pages.

   Implementations can be PDF parsers, DOCX parsers, or any other
   document format parser.


   .. py:method:: parse(path)

      Parse a document file into a list of structured pages.

      :param path: Path to the document file

      :returns:     - page_num: int
                    - text: str (aggregated text)
                    - blocks: List[Dict] (structured blocks)
                    - metadata: Dict (optional)
      :rtype: List of page dictionaries, each containing



.. py:class:: HeadingDetector

   Bases: :py:obj:`Protocol`


   Abstract interface for heading detection in documents.

   Can use heuristics, ML models, or rule-based systems.


   .. py:method:: detect_headings(blocks)

      Classify blocks as headings or regular text.

      :param blocks: List of text blocks with formatting info

      :returns: Same blocks with added 'is_heading' boolean field



.. py:class:: LanguageDetector

   Bases: :py:obj:`Protocol`


   Abstract interface for language detection.

   Implementations can use fastText, langdetect, or cloud services.


   .. py:method:: detect(text)

      Detect the language of a text string.

      :param text: Input text to analyze

      :returns: ISO language code (e.g., 'en', 'it', 'fr')



.. py:class:: OCREngine

   Bases: :py:obj:`Protocol`


   Abstract interface for OCR operations.

   Implementations can use Tesseract, cloud OCR services, or other engines.


   .. py:method:: needs_ocr(input_path, text_threshold = 200)

      Check if a document needs OCR based on existing text content.

      :param input_path: Path to the document (usually PDF)
      :param text_threshold: Minimum text length to consider document as text-based

      :returns: True if OCR is needed, False otherwise



   .. py:method:: apply_ocr(input_path, output_path)

      Apply OCR to a document and save the result.

      :param input_path: Path to the input document
      :param output_path: Path where to save the OCR-ed document



.. py:data:: PageDict

   A page is a dictionary with text, blocks, and metadata.

.. py:class:: TableDetector

   Bases: :py:obj:`Protocol`


   Abstract interface for table detection in documents.


   .. py:method:: detect_tables(page_data)

      Detect and extract tables from a page.

      :param page_data: Page dictionary with layout information

      :returns: List of table dictionaries with extracted data



.. py:class:: IngestionService(pdf_parser, docx_parser, ocr_engine = None, lang_detector = None, ocr_text_threshold = 200)

   High-level orchestrator for document ingestion.

   This service coordinates parsing, OCR, and language detection
   using injected dependencies (dependency injection pattern).

   :param pdf_parser: Parser implementation for PDF files
   :param docx_parser: Parser implementation for DOCX files
   :param ocr_engine: Optional OCR engine for image-based PDFs
   :param lang_detector: Optional language detector for extracted text
   :param ocr_text_threshold: Minimum text length before skipping OCR


   .. py:attribute:: pdf_parser


   .. py:attribute:: docx_parser


   .. py:attribute:: ocr_engine
      :value: None



   .. py:attribute:: lang_detector
      :value: None



   .. py:attribute:: ocr_text_threshold
      :value: 200



   .. py:method:: parse_document(path, doc_id = None)

      Parse a document file (PDF or DOCX) into structured data.

      :param path: Path to the document file
      :param doc_id: Optional document ID (auto-generated if not provided)

      :returns:     - doc_id: Unique document identifier
                    - filename: Original filename
                    - language: Detected language code
                    - pages: List of parsed pages with blocks
      :rtype: Dictionary containing

      :raises ValueError: If file extension is not supported
      :raises FileNotFoundError: If file does not exist



